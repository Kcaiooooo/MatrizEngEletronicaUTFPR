<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matriz Curricular - Engenharia Elétrica UTFPR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
    <script src="https://mozilla.github.io/pdf.js/build/pdf.mjs" type="module"></script>
<style>
    body { font-family: 'Inter', sans-serif; background-color: #1f2937; }
    .font-header { font-family: 'Roboto Slab', serif; }
    .tree-wrapper { position: relative; width: 100%; border-radius: 0.75rem; cursor: grab; }
    #main-container, #humanities-container, #optional-container {
        position: relative; width: 100%; min-height: 390vh;
        background-color: #111827;
        background-image: linear-gradient(rgba(255, 255, 255, 0.04) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.04) 1px, transparent 1px);
        background-size: 25px 25px; border-radius: 0.75rem; overflow: visible;
    }
    .node {
        position: absolute; display: flex; align-items: center; justify-content: center;
        width: 130px; height: 90px; border-radius: 0.75rem; border: 3px solid;
        cursor: pointer; transition: all 0.3s ease; transform: translate(-50%, -50%);
        z-index: 10; padding: 5px; text-align: center; box-sizing: border-box; font-size: 11px;
    }
    .node:hover { z-index: 99; }
    /* States */
    .subject-locked, .humanities-locked, .optional-locked { background-color: #374151; border-color: #4b5563; color: #9ca3af; }
    .subject-available { background-color: #2563eb; border-color: #60a5fa; color: white; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
    .subject-completed, .humanities-completed, .optional-completed { background-color: #16a34a; border-color: #4ade80; color: white; font-weight: bold; box-shadow: 0 0 20px rgba(74, 222, 128, 0.7); }
    .subject-satisfied { background-color: #4a4a28; border-color: #fbbf24; color: #fde68a; cursor: not-allowed; }
    .humanities-available { background-color: #a855f7; border-color: #c084fc; color: white; box-shadow: 0 0 15px rgba(168, 85, 247, 0.5); }
    .optional-available { background-color: #dc2626; border-color: #f87171; color: white; box-shadow: 0 0 15px rgba(220, 38, 38, 0.5); }
    
    .node .tooltip {
        visibility: hidden; opacity: 0; width: 220px; background-color: #1f2937; color: #fff; text-align: center;
        border-radius: 6px; padding: 8px; position: absolute; z-index: 20; bottom: 115%; left: 50%;
        margin-left: -110px; transition: opacity 0.3s; border: 1px solid #4b5563;
    }
    .node .tooltip::after {
        content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px;
        border-style: solid; border-color: #1f2937 transparent transparent transparent;
    }
    .node .tooltip.visible { visibility: visible; opacity: 1; }
    .node .tooltip.below { bottom: auto; top: 115%; }
    .node .tooltip.below::after { top: auto; bottom: 100%; border-color: transparent transparent #1f2937 transparent; }

    .line-locked { stroke: #4b5563; stroke-width: 2; stroke-dasharray: 4, 4; fill: none; }
    .line-completed { stroke: #16a34a; stroke-width: 3; fill: none; filter: drop-shadow(0 0 3px #4ade80); transition: stroke-dashoffset 1.5s ease-out; }
    
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 50; }
    .modal-box { background-color: #1f2937; border-radius: 0.75rem; padding: 2rem; border: 1px solid #4b5563; }
    .tab-btn { padding: 0.75rem 1.5rem; font-weight: 600; cursor: pointer; border: none; background-color: transparent; color: #9ca3af; border-bottom: 3px solid transparent; }
    .tab-btn.active { color: #60a5fa; border-bottom-color: #60a5fa; }
    .hidden { display: none; }
    
    .track-header {
        position: absolute; left: 5px; transform: translateY(-50%); color: #9ca3af; font-weight: bold;
        font-size: 1rem; background-color: rgba(31, 41, 55, 0.6); padding: 8px 4px; border-radius: 8px;
        writing-mode: vertical-rl; text-orientation: mixed;
    }

    @media (max-width: 768px) {
        #main-container, #humanities-container, #optional-container { width: 280%; height: 135vh; }
        .node { width: 110px; height: 75px; font-size: 10px; }
    }
</style>
</head>

<footer class="bg-gray-900 text-center py-6 mt-8 rounded-lg shadow-inner">
    <div class="max-w-7xl mx-auto px-4">
        <p class="text-gray-400 mb-3">Desenvolvido com ❤️ por <strong class="font-semibold text-white">Kcaio</strong></p>
        <div class="flex justify-center items-center space-x-6 mb-4">
             <a href="https://www.linkedin.com/in/caio-costa-386011258/" target="_blank" class="text-gray-400 hover:text-blue-400">LinkedIn</a>
             <a href="mailto:caiocosta281214@gmail.com" class="text-gray-400 hover:text-red-500">Gmail</a>
        </div>
        <div class="mt-4">
            <p class="text-gray-400 text-sm">Essa ferramenta foi útil? Considere fazer um Pix!</p>
            <img src="imagens/PIX.png" alt="QR Code PIX" class="w-40 h-40 mx-auto my-4 rounded-lg border-2 border-gray-700">
            <p class="text-amber-400 font-mono bg-gray-800 inline-block px-3 py-1 rounded">Chave: <strong>caiocosta281214@gmail.com</strong></p>
        </div>
    </div>
</footer>

<body class="bg-gray-800 text-white p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold font-header text-blue-400">Árvore de Habilidades - Eng. Elétrica</h1>
            <p class="text-gray-300 mt-2">UTFPR - Câmpus Curitiba (Matriz 979)</p>
        </header>

        <div id="progress-panel" class="bg-gray-700 p-6 rounded-lg shadow-lg mb-6 space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <div class="flex justify-between mb-1"><span class="text-base font-medium text-gray-200">Progresso (Obrigatórias)</span><span id="total-progress-text" class="text-sm font-medium text-gray-200">0%</span></div>
                    <div class="w-full bg-gray-600 rounded-full h-4"><div id="total-progress-bar" class="bg-green-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                </div>
                <div>
                    <div class="flex justify-between mb-1">
                        <label for="period-slider" class="text-base font-medium text-gray-200">Período Atual</label>
                        <span id="period-display" class="text-sm font-medium text-gray-200">Período 1</span>
                    </div>
                    <input id="period-slider" type="range" min="1" max="10" value="1" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>
            <hr class="border-gray-600 my-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                 <div>
                    <div class="flex justify-between mb-1"><span class="text-base font-medium text-red-300">Optativas (Trilhas)</span><span id="optional-progress-text" class="text-sm font-medium text-red-300">0h</span></div>
                    <div class="w-full bg-gray-900 rounded-full h-4"><div id="optional-progress-bar" class="bg-red-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                </div>
                <div>
                    <div class="flex justify-between mb-1"><span class="text-base font-medium text-purple-300">Humanidades</span><span id="humanities-progress-text" class="text-sm font-medium text-purple-300">0h</span></div>
                    <div class="w-full bg-gray-900 rounded-full h-4"><div id="humanities-progress-bar" class="bg-purple-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                </div>
            </div>
        </div>
        
        <div class="bg-gray-700 p-6 rounded-lg shadow-lg mb-6 flex flex-col sm:flex-row justify-center items-center gap-4">
            <label for="pdf-upload" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg cursor-pointer transition-colors">Importar Histórico (PDF)</label>
            <input type="file" id="pdf-upload" accept=".pdf" class="hidden">
            <button id="reset-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Resetar Progresso</button>
            <p id="upload-status" class="text-center text-gray-400 h-4"></p>
        </div>

        <div class="flex justify-center mb-4 border-b border-gray-600">
            <button id="tab-main" class="tab-btn active">Obrigatórias</button>
            <button id="tab-humanities" class="tab-btn">Humanidades</button>
            <button id="tab-optional" class="tab-btn">Trilhas e Optativas</button>
        </div>

        <div class="tree-wrapper">
            <div id="main-container" class="shadow-2xl">
                <svg id="main-lines" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none;"><defs><marker id="arrow-completed" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#16a34a"></path></marker><marker id="arrow-locked" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#4b5563"></path></marker></defs></svg>
            </div>
            <div id="humanities-container" class="shadow-2xl hidden">
                 <svg id="humanities-lines" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none;"><defs><marker id="h-arrow-completed" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#16a34a"></path></marker><marker id="h-arrow-locked" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#4b5563"></path></marker></defs></svg>
            </div>
            <div id="optional-container" class="shadow-2xl hidden">
                 <svg id="optional-lines" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none;"><defs><marker id="o-arrow-completed" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#16a34a"></path></marker><marker id="o-arrow-locked" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#4b5563"></path></marker></defs></svg>
            </div>
        </div>
    </div>

    <div id="prerequisite-modal" class="modal-overlay hidden">
        <div class="modal-box text-center">
            <h3 class="text-xl font-bold mb-2 text-yellow-400">Atenção!</h3>
            <p id="modal-text" class="text-gray-300 mb-6">Pré-requisitos não concluídos. Deseja liberar mesmo assim?</p>
            <div class="flex justify-center gap-4"><button id="cancel-override-btn" class="bg-gray-500 hover:bg-gray-600 px-6 py-2 rounded">Não</button><button id="confirm-override-btn" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded">Sim</button></div>
        </div>
    </div>
    <div id="celebration-modal" class="modal-overlay hidden">
        <div class="modal-box text-center p-8 border-2 border-amber-400"><h2 class="text-4xl font-bold text-amber-300 mb-4">Parabéns!</h2><p class="text-gray-300 mb-8">Curso de Engenharia Elétrica concluído!</p><button id="close-celebration-btn" class="bg-amber-500 hover:bg-amber-600 px-8 py-2 rounded">Fechar</button></div>
    </div>
    <audio id="celebration-audio" src="audio/vitoria.mp3" preload="auto" loop></audio>

    <script type="module">
        const NODE_WIDTH = 130;
        const NODE_HEIGHT = 90;
        
        // --- DADOS DA MATRIZ ELÉTRICA (979) ---
        
        const SPECIALIZATION_TRACKS = {
            'Automação e Sistemas': ['ELT75H', 'ELT76G', 'ELT76H', 'ELT771', 'ELT7AA', 'ELT7AB', 'ELT7AC', 'ELT7AD'],
            'Energia e Sustentabilidade': ['ELT7BA', 'ELT7BB', 'ELT7BC', 'ELT7BD', 'ELT7BE', 'ELT7BF'],
            'Instalações e Eficiência': ['ELT7CA', 'ELT7CB', 'ELT7CC', 'ELT7CD', 'ELT7CE'],
            'Manutenção Industrial': ['ELT7DA', 'ELT7DB', 'ELT7DC', 'ELT7DD', 'ELT7DE', 'ELT7DF', 'ELT7DG', 'ELT7DH'],
            'Modelagem e Controle': ['ELT75A', 'ELT76A', 'ELT77A', 'ELT7EA', 'ELT7EB', 'ELT7EC', 'ELT7EE'],
            'Projetos Eletrônicos': ['ELT7FA', 'ELT7FB', 'ELT7FC', 'ELT7FD', 'ELT7FE', 'ELT7FF']
        };

        const OPTIONAL_GROUPS_CONFIG = {
            '[1150]': { requiredHours: 135, name: 'Automação e Sistemas' },
            '[1151]': { requiredHours: 135, name: 'Modelagem e Controle' },
            '[1152]': { requiredHours: 135, name: 'Manutenção Industrial' },
            '[1153]': { requiredHours: 135, name: 'Projetos Eletrônicos' },
            '[1144]': { requiredHours: 135, name: 'Energia e Sustentabilidade' },
            '[1143]': { requiredHours: 135, name: 'Instalações e Eficiência' },
            '[1142]': { requiredHours: 135, name: 'Empregabilidade e Empreend.' },
            '[1141]': { requiredHours: 135, name: 'Humanidades' }
        };

        const allNodesData = [
            // PERÍODO 1
            { id: 'ELT71A', name: 'Intro. Eng. Elétrica', period: 1, cht: 75, x: 10, y: 2, type: 'subject', dependencies: [] },
            { id: 'ELT71B', name: 'Desenho Elétrico', period: 1, cht: 45, x: 25, y: 2, type: 'subject', dependencies: [] },
            { id: 'ELT71C', name: 'Lab. Instalações Elétricas', period: 1, cht: 45, x: 40, y: 2, type: 'subject', dependencies: [] },
            { id: 'INF71A', name: 'Computação 1', period: 1, cht: 60, x: 55, y: 2, type: 'subject', dependencies: [] },
            { id: 'MAT7GA', name: 'Geometria Analítica', period: 1, cht: 60, x: 70, y: 2, type: 'subject', dependencies: [] },
            { id: 'MAT7PC', name: 'Pré-Cálculo', period: 1, cht: 60, x: 85, y: 2, type: 'subject', dependencies: [] },

            // PERÍODO 2
            { id: 'ELT72A', name: 'Fund. Gestão', period: 2, cht: 45, x: 10, y: 13, type: 'subject', dependencies: [] },
            { id: 'ELT72B', name: 'Sistemas Digitais', period: 2, cht: 60, x: 23, y: 13, type: 'subject', dependencies: [] },
            { id: 'ELT72C', name: 'Fenômenos Eletromag.', period: 2, cht: 90, x: 36, y: 13, type: 'subject', dependencies: ['MAT7PC', 'FIS7F1'] }, 
            { id: 'FIS7F1', name: 'Física Teórica 1', period: 2, cht: 60, x: 49, y: 13, type: 'subject', dependencies: [] },
            { id: 'INF72A', name: 'Computação 2', period: 2, cht: 60, x: 62, y: 13, type: 'subject', dependencies: ['INF71A'] },
            { id: 'MAT7AL', name: 'Álgebra Linear', period: 2, cht: 60, x: 75, y: 13, type: 'subject', dependencies: ['MAT7GA'] },
            { id: 'MAT7C1', name: 'Cálculo 1', period: 2, cht: 90, x: 88, y: 13, type: 'subject', dependencies: ['MAT7PC'] },

            // PERÍODO 3
            { id: 'COE70A', name: 'Com. Oral e Escrita', period: 3, cht: 30, x: 10, y: 23, type: 'subject', dependencies: [] },
            { id: 'ELT73A', name: 'Microcontrolados', period: 3, cht: 60, x: 22, y: 23, type: 'subject', dependencies: ['ELT72B', 'INF72A'] },
            { id: 'ELT73B', name: 'Análise de Circuitos A', period: 3, cht: 60, x: 34, y: 23, type: 'subject', dependencies: ['ELT72C'] },
            { id: 'FIS7E1', name: 'Física Exp. 1', period: 3, cht: 30, x: 46, y: 23, type: 'subject', dependencies: ['FIS7F1'] },
            { id: 'FIS7F2', name: 'Física Teórica 2', period: 3, cht: 60, x: 58, y: 23, type: 'subject', dependencies: ['FIS7F1'] },
            { id: 'MAT7C2', name: 'Cálculo 2', period: 3, cht: 90, x: 70, y: 23, type: 'subject', dependencies: ['MAT7C1', 'MAT7GA'] },
            { id: 'MAT7ED', name: 'Eq. Diferenciais Ord.', period: 3, cht: 60, x: 82, y: 23, type: 'subject', dependencies: ['MAT7AL', 'MAT7C1'] },
            { id: 'GEE7E3', name: 'Fund. Economia', period: 3, cht: 30, x: 94, y: 23, type: 'subject', dependencies: [] },

            // PERÍODO 4
            { id: 'ELT74A', name: 'Fund. Fenômenos Transp.', period: 4, cht: 30, x: 10, y: 34, type: 'subject', dependencies: ['FIS7F2'] },
            { id: 'ELT74B', name: 'Análise de Circuitos B', period: 4, cht: 90, x: 25, y: 34, type: 'subject', dependencies: ['ELT73B', 'MAT7ED'] },
            { id: 'ELT74C', name: 'Sinais e Sistemas', period: 4, cht: 60, x: 40, y: 34, type: 'subject', dependencies: ['ELT73B'] },
            { id: 'ELT74D', name: 'Mat. e Equip. Elétricos 1', period: 4, cht: 30, x: 55, y: 34, type: 'subject', dependencies: ['MAT7ED'] },
            { id: 'ELT74E', name: 'Amp. Op. e Semicondutores', period: 4, cht: 90, x: 70, y: 34, type: 'subject', dependencies: ['ELT71B', 'ELT71C', 'ELT73B'] },
            { id: 'ELT74F', name: 'Oficina Integração 1', period: 4, cht: 30, x: 85, y: 34, type: 'subject', dependencies: [] },

            // PERÍODO 5
            { id: 'ELT75B', name: 'Elementos de Mecânica', period: 5, cht: 60, x: 10, y: 45, type: 'subject', dependencies: ['FIS7F1', 'MAT7GA'] },
            { id: 'ELT75C', name: 'Sist. Eletromagnéticos', period: 5, cht: 45, x: 25, y: 45, type: 'subject', dependencies: ['ELT71C', 'ELT72C'] },
            { id: 'ELT75D', name: 'Prob. e Estatística', period: 5, cht: 45, x: 40, y: 45, type: 'subject', dependencies: ['MAT7PC'] },
            { id: 'ELT75E', name: 'Eletrônica de Potência', period: 5, cht: 90, x: 55, y: 45, type: 'subject', dependencies: ['ELT74B', 'ELT74E'] },
            { id: 'ELT75F', name: 'Medidas Elétricas', period: 5, cht: 60, x: 70, y: 45, type: 'subject', dependencies: ['ELT74B'] },
            { id: 'ELT75G', name: 'Eletromagnetismo', period: 5, cht: 60, x: 85, y: 45, type: 'subject', dependencies: ['ELT72C', 'MAT7AL'] },

            // PERÍODO 6
            { id: 'ELT76B', name: 'Inst. Elét. Prediais 1', period: 6, cht: 75, x: 15, y: 55, type: 'subject', dependencies: ['ELT74D'] },
            { id: 'ELT76C', name: 'Conv. Eletromec. Energia 1', period: 6, cht: 90, x: 32, y: 55, type: 'subject', dependencies: ['ELT74B'] },
            { id: 'ELT76D', name: 'Controle Sist. Din.', period: 6, cht: 60, x: 49, y: 55, type: 'subject', dependencies: ['ELT72B', 'ELT74C'] },
            { id: 'ELT76E', name: 'Sist. Elét. Potência 1', period: 6, cht: 90, x: 66, y: 55, type: 'subject', dependencies: ['ELT74B'] },
            { id: 'ELT76F', name: 'Oficina Integração II', period: 6, cht: 105, x: 83, y: 55, type: 'subject', dependencies: ['Periodo:6'] },

            // PERÍODO 7
            { id: 'ELT77B', name: 'Inst. Elét. Ind. 1', period: 7, cht: 75, x: 10, y: 66, type: 'subject', dependencies: ['ELT76B'] },
            { id: 'ELT77C', name: 'Conv. Eletromec. Energia 2', period: 7, cht: 60, x: 26, y: 66, type: 'subject', dependencies: ['ELT76C'] },
            { id: 'ELT77D', name: 'CLP', period: 7, cht: 60, x: 42, y: 66, type: 'subject', dependencies: ['ELT75C'] },
            { id: 'ELT77E', name: 'Sist. Elét. Potência 2', period: 7, cht: 60, x: 58, y: 66, type: 'subject', dependencies: ['ELT76E'] },
            { id: 'ELT77F', name: 'Seg. e Legislação', period: 7, cht: 60, x: 74, y: 66, type: 'subject', dependencies: [] },
            { id: 'ELT77G', name: 'Noções Telecom', period: 7, cht: 60, x: 90, y: 66, type: 'subject', dependencies: ['ELT74C'] },

            // PERÍODO 8 (Obrigatórias apenas, optativas abaixo)
            { id: 'ELT78A', name: 'Metodologia TCC', period: 8, cht: 30, x: 30, y: 77, type: 'subject', dependencies: ['Periodo:7'] },
            { id: 'ELT78B', name: 'Oficina Integração III', period: 8, cht: 120, x: 50, y: 77, type: 'subject', dependencies: ['Periodo:8'] },
            { id: 'ELT78D', name: 'Estágio Obrigatório', period: 8, cht: 360, x: 70, y: 77, type: 'subject', dependencies: ['Periodo:7'] },
            
            // PERÍODO 9
            { id: 'ELT79B', name: 'TCC', period: 9, cht: 75, x: 50, y: 88, type: 'subject', dependencies: ['ELT78A'] }
        ];

        const allHumanitiesData = [
            // Grupo [1141] - Humanidades (Normalmente Período 5)
            { id: 'FCH7AA', name: 'Dança e Tecnologia', period: 5, cht: 60, type: 'humanities', x: 10, y: 20 },
            { id: 'FCH7AB', name: 'Questões Contemp. Corpo', period: 5, cht: 60, type: 'humanities', x: 30, y: 20 },
            { id: 'FCH7FA', name: 'Filosofia da Ciência', period: 5, cht: 45, type: 'humanities', x: 50, y: 20 },
            { id: 'FCH7FB', name: 'Fund. da Ética', period: 5, cht: 45, type: 'humanities', x: 70, y: 20 },
            { id: 'FCH7SA', name: 'Sociologia', period: 5, cht: 45, type: 'humanities', x: 90, y: 20 },
            { id: 'FCH7SC', name: 'Tecnologia, Trab. e Saúde', period: 5, cht: 45, type: 'humanities', x: 10, y: 40 },
            { id: 'FCH7SD', name: 'Soc. e Política no BR', period: 5, cht: 45, type: 'humanities', x: 30, y: 40 },
            { id: 'EDU70J', name: 'LIBRAS', period: 5, cht: 45, type: 'humanities', x: 50, y: 40 }
        ];

        const allOptionalNodesData = [
            // --- TRILHA AUTOMACÃO E SISTEMAS [1150] ---
            { id: 'ELT75H', name: 'Instrumentação Ind.', dependencies: ['ELT74E'], period: 8, cht: 60, x: 10, y: 10, type: 'optional', groupId: '[1150]' },
            { id: 'ELT76G', name: 'Sist. Pneumáticos', dependencies: ['ELT75C'], period: 8, cht: 45, x: 20, y: 10, type: 'optional', groupId: '[1150]' },
            { id: 'ELT76H', name: 'Instrumentação Virtual', dependencies: ['INF72A'], period: 8, cht: 60, x: 30, y: 10, type: 'optional', groupId: '[1150]' },
            { id: 'ELT771', name: 'IoT Industrial', dependencies: ['ELT76H'], period: 8, cht: 60, x: 40, y: 10, type: 'optional', groupId: '[1150]' },
            { id: 'ELT7AE', name: 'Indústria 4.0', dependencies: [], period: 8, cht: 60, x: 50, y: 10, type: 'optional', groupId: '[1150]' },
            
            // --- TRILHA ENERGIA E SUSTENTABILIDADE [1144] ---
            { id: 'ELT7BA', name: 'Planej. Sist. Potência', dependencies: [], period: 8, cht: 45, x: 10, y: 25, type: 'optional', groupId: '[1144]' },
            { id: 'ELT7BD', name: 'Geração Energia Elét.', dependencies: [], period: 8, cht: 45, x: 25, y: 25, type: 'optional', groupId: '[1144]' },
            { id: 'ELT7BH', name: 'Linhas Transmissão', dependencies: [], period: 8, cht: 45, x: 40, y: 25, type: 'optional', groupId: '[1144]' },
            { id: 'ELT7BO', name: 'Subestações', dependencies: [], period: 8, cht: 60, x: 55, y: 25, type: 'optional', groupId: '[1144]' },
            { id: 'ELT7BP', name: 'Smart Grids', dependencies: [], period: 8, cht: 45, x: 70, y: 25, type: 'optional', groupId: '[1144]' },

             // --- TRILHA INSTALAÇÕES E EFICIÊNCIA [1143] ---
            { id: 'ELT7CA', name: 'Efic. Energética', dependencies: [], period: 8, cht: 45, x: 10, y: 40, type: 'optional', groupId: '[1143]' },
            { id: 'ELT7CB', name: 'Energia Solar I', dependencies: [], period: 8, cht: 45, x: 25, y: 40, type: 'optional', groupId: '[1143]' },
            { id: 'ELT7CE', name: 'Inst. Ind. 2', dependencies: ['ELT77B'], period: 8, cht: 45, x: 40, y: 40, type: 'optional', groupId: '[1143]' },
            { id: 'ELT7CD', name: 'Ger. Obras Elétricas', dependencies: [], period: 8, cht: 60, x: 55, y: 40, type: 'optional', groupId: '[1143]' },

            // --- TRILHA MODELAGEM E CONTROLE [1151] ---
            { id: 'ELT75A', name: 'Análise Sist. Lineares', dependencies: ['ELT74C'], period: 8, cht: 30, x: 10, y: 55, type: 'optional', groupId: '[1151]' },
            { id: 'ELT76A', name: 'Controle Contínuo', dependencies: ['ELT75A'], period: 8, cht: 60, x: 25, y: 55, type: 'optional', groupId: '[1151]' },
            { id: 'ELT77A', name: 'Controle Discreto', dependencies: ['ELT76A'], period: 8, cht: 60, x: 40, y: 55, type: 'optional', groupId: '[1151]' },
            { id: 'ELT7EE', name: 'Controle Multivariável', dependencies: [], period: 8, cht: 60, x: 55, y: 55, type: 'optional', groupId: '[1151]' },

            // --- TRILHA PROJETOS ELETRÔNICOS [1153] ---
            { id: 'ELT7FA', name: 'Inversores PWM', dependencies: [], period: 8, cht: 60, x: 10, y: 70, type: 'optional', groupId: '[1153]' },
            { id: 'ELT7FE', name: 'Lógica Reconfig.', dependencies: [], period: 8, cht: 60, x: 30, y: 70, type: 'optional', groupId: '[1153]' },
            { id: 'ELT7FF', name: 'Conversores CC-CA', dependencies: [], period: 8, cht: 60, x: 50, y: 70, type: 'optional', groupId: '[1153]' },
            { id: 'ELT7FH', name: 'Compatib. Eletromag.', dependencies: [], period: 8, cht: 45, x: 70, y: 70, type: 'optional', groupId: '[1153]' },

             // --- TRILHA EMPREGABILIDADE [1142] ---
            { id: 'GEE7A2', name: 'Fund. Adm. (Opt)', dependencies: [], period: 8, cht: 45, x: 10, y: 85, type: 'optional', groupId: '[1142]' },
            { id: 'GEE7E2', name: 'Fund. Empreend.', dependencies: [], period: 8, cht: 30, x: 30, y: 85, type: 'optional', groupId: '[1142]' },
            { id: 'GEE7F2', name: 'Fund. Finanças', dependencies: [], period: 8, cht: 60, x: 50, y: 85, type: 'optional', groupId: '[1142]' }
        ];
        
        // --- (O restante da lógica é idêntico à M3: Inicialização, Renderização, Pan/Zoom, Save/Load, PDF Parser) ---
        // Para economizar espaço, a lógica central JS é a mesma do seu arquivo M3,
        // mas utilizando as variáveis `allNodesData`, `allOptionalNodesData` etc definidos acima.
        // Você deve copiar o bloco <script> inteiro do M3 e substituir apenas as definições de CONSTANTS e ARRAYS de dados.

        // ... (Copie aqui o restante do script do Skill tree M3.html, mantendo a lógica de updateAllSubjectStates, renderActiveTree, etc.)
        
        // ==========================================
        // ABAIXO UMA VERSÃO SIMPLIFICADA DA LOGICA DE INICIALIZAÇÃO PARA FUNCIONAR IMEDIATAMENTE
        // (Recomendo copiar o bloco completo do M3 para ter todas as funcionalidades como PDF Upload e Save)
        // ==========================================
        
        let nodes = JSON.parse(JSON.stringify(allNodesData));
        let humanitiesNodes = JSON.parse(JSON.stringify(allHumanitiesData));
        let optionalNodes = JSON.parse(JSON.stringify(allOptionalNodesData));
        let currentPeriod = 1;
        let activeTree = 'main';
        let completedAcActivities = []; // Mock
        let completedCceActivities = []; // Mock

        const mainContainer = document.getElementById('main-container');
        const humanitiesContainer = document.getElementById('humanities-container');
        const optionalContainer = document.getElementById('optional-container');
        const tabMain = document.getElementById('tab-main');
        const tabHumanities = document.getElementById('tab-humanities');
        const tabOptional = document.getElementById('tab-optional');
        const slider = document.getElementById('period-slider');

        function init() {
            updateStates();
            renderActive();
            slider.addEventListener('input', (e) => { currentPeriod = parseInt(e.target.value); updateStates(); renderActive(); document.getElementById('period-display').innerText = `Período ${currentPeriod}`; });
            tabMain.addEventListener('click', () => switchTab('main'));
            tabHumanities.addEventListener('click', () => switchTab('humanities'));
            tabOptional.addEventListener('click', () => switchTab('optional'));
        }

        function switchTab(tab) {
            activeTree = tab;
            mainContainer.classList.add('hidden'); humanitiesContainer.classList.add('hidden'); optionalContainer.classList.add('hidden');
            tabMain.classList.remove('active'); tabHumanities.classList.remove('active'); tabOptional.classList.remove('active');
            
            if(tab === 'main') { mainContainer.classList.remove('hidden'); tabMain.classList.add('active'); }
            else if(tab === 'humanities') { humanitiesContainer.classList.remove('hidden'); tabHumanities.classList.add('active'); }
            else { optionalContainer.classList.remove('hidden'); tabOptional.classList.add('active'); renderTrackHeaders(); }
            renderActive();
        }

        function updateStates() {
            // Lógica simplificada de estados baseada no período
            [nodes, humanitiesNodes, optionalNodes].forEach(list => {
                list.forEach(n => {
                    if(n.state === 'subject-completed' || n.state === 'humanities-completed' || n.state === 'optional-completed') return;
                    // Verifica dependencias (simplificado para demo)
                    let available = true;
                    if(n.dependencies) {
                         n.dependencies.forEach(dep => {
                             if(dep.startsWith('Periodo:')) {
                                 let p = parseInt(dep.split(':')[1]);
                                 if(currentPeriod < p) available = false;
                             } else {
                                 // Busca pai na lista principal (assumindo principal)
                                 let parent = nodes.find(x => x.id === dep);
                                 if(parent && parent.state !== 'subject-completed') available = false;
                             }
                         });
                    }
                    if(n.period > currentPeriod + 2) available = false;
                    
                    let prefix = n.type === 'humanities' ? 'humanities' : (n.type === 'optional' ? 'optional' : 'subject');
                    n.state = available ? `${prefix}-available` : `${prefix}-locked`;
                });
            });
            updateProgress();
        }

        function renderActive() {
            let container = activeTree === 'main' ? mainContainer : (activeTree === 'humanities' ? humanitiesContainer : optionalContainer);
            let data = activeTree === 'main' ? nodes : (activeTree === 'humanities' ? humanitiesNodes : optionalNodes);
            
            // Limpa nodes, mantem SVG
            let svg = container.querySelector('svg');
            container.innerHTML = '';
            container.appendChild(svg);
            if(activeTree === 'optional') renderTrackHeaders();

            data.forEach(n => {
                let el = document.createElement('div');
                el.className = `node ${n.state}`;
                el.style.left = `${n.x}%`; el.style.top = `${n.y}%`;
                el.innerHTML = `<span class="font-bold">${n.id}</span><br><span class="text-xs">${n.name}</span>`;
                el.onclick = () => toggleNode(n);
                container.appendChild(el);
            });
            // (Adicione aqui a função de desenhar linhas renderLines igual ao M3)
        }

        function toggleNode(n) {
            let prefix = n.type === 'humanities' ? 'humanities' : (n.type === 'optional' ? 'optional' : 'subject');
            if(n.state === `${prefix}-locked`) return;
            n.state = n.state === `${prefix}-completed` ? `${prefix}-available` : `${prefix}-completed`;
            updateStates(); renderActive();
        }

        function updateProgress() {
             let completed = nodes.filter(n => n.state === 'subject-completed').length;
             document.getElementById('total-progress-bar').style.width = `${(completed/nodes.length)*100}%`;
             document.getElementById('total-progress-text').innerText = `${((completed/nodes.length)*100).toFixed(1)}%`;
        }
        
        function renderTrackHeaders() {
             // Exemplo de headers
             const tracks = [['Automação', 10], ['Energia', 25], ['Instalações', 40], ['Controle', 55], ['Eletrônica', 70], ['Empregabilidade', 85]];
             tracks.forEach(t => {
                 let h = document.createElement('div'); h.className = 'track-header'; 
                 h.innerText = t[0]; h.style.top = `${t[1]}%`;
                 optionalContainer.appendChild(h);
             });
        }

        init();
    </script>
</body>
</html>
